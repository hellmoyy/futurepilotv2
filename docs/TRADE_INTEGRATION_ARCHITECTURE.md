# Trade Integration - Visual Architecture

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          USER DASHBOARD                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ Active Tradesâ”‚  â”‚ Total Profit â”‚  â”‚   Win Rate   â”‚             â”‚
â”‚  â”‚      2       â”‚  â”‚  $1,250.50   â”‚  â”‚    66.67%    â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ GET /api/trades/stats
                             â”‚ GET /api/trades/active
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          API LAYER                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  /api/trades/stats          â†’ TradeManager.getTradeStats() â”‚    â”‚
â”‚  â”‚  /api/trades/active         â†’ TradeManager.getOpenTrades() â”‚    â”‚
â”‚  â”‚  /api/trades/[id] PATCH     â†’ TradeManager.closeTrade()    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      TRADE MANAGER SERVICE                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â€¢ createTrade()        â†’ Create new trade record           â”‚    â”‚
â”‚  â”‚ â€¢ closeTrade()         â†’ Update with exit price & PnL      â”‚    â”‚
â”‚  â”‚ â€¢ getOpenTrades()      â†’ Query open positions              â”‚    â”‚
â”‚  â”‚ â€¢ getTradeStats()      â†’ Calculate statistics              â”‚    â”‚
â”‚  â”‚ â€¢ calculatePnL()       â†’ Compute profit/loss               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  TRADING ENGINE    â”‚   â”‚   MONGODB          â”‚
    â”‚  (Bot Execution)   â”‚   â”‚   (Trade Model)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Trade Lifecycle Flow

```
START
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. BOT ANALYZES MARKET                  â”‚
â”‚    â€¢ Check RSI, MACD, EMA               â”‚
â”‚    â€¢ AI analysis via OpenAI             â”‚
â”‚    â€¢ Generate BUY/SELL/HOLD signal      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼ Signal = BUY
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. EXECUTE ORDER                        â”‚
â”‚    a) Place Binance futures order       â”‚
â”‚    b) Get entry price                   â”‚
â”‚    c) Calculate SL/TP                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. CREATE TRADE RECORD                  â”‚
â”‚    TradeManager.createTrade()           â”‚
â”‚    â€¢ userId: user123                    â”‚
â”‚    â€¢ symbol: BTCUSDT                    â”‚
â”‚    â€¢ side: long                         â”‚
â”‚    â€¢ entryPrice: $65,000                â”‚
â”‚    â€¢ quantity: 0.1                      â”‚
â”‚    â€¢ stopLoss: $64,000                  â”‚
â”‚    â€¢ takeProfit: $67,000                â”‚
â”‚    â€¢ status: open                       â”‚
â”‚    â€¢ Store trade._id                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. PLACE STOP ORDERS                    â”‚
â”‚    â€¢ Stop Loss @ $64,000                â”‚
â”‚    â€¢ Take Profit @ $67,000              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. MONITOR POSITION                     â”‚
â”‚    â€¢ Check current price                â”‚
â”‚    â€¢ Calculate unrealized PnL           â”‚
â”‚    â€¢ Wait for exit condition            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼ Take Profit Hit!
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. CLOSE POSITION                       â”‚
â”‚    a) Cancel open orders                â”‚
â”‚    b) Place market close order          â”‚
â”‚    c) Get exit price: $67,000           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. UPDATE TRADE RECORD                  â”‚
â”‚    TradeManager.closeTrade()            â”‚
â”‚    â€¢ exitPrice: $67,000                 â”‚
â”‚    â€¢ pnl: +$200.00                      â”‚
â”‚    â€¢ pnlPercentage: +3.08%              â”‚
â”‚    â€¢ status: closed                     â”‚
â”‚    â€¢ exitTime: 2024-01-15 14:30         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. DASHBOARD UPDATES                    â”‚
â”‚    â€¢ Active Trades: 1 (was 2)           â”‚
â”‚    â€¢ Total Profit: $1,450.50 (+$200)    â”‚
â”‚    â€¢ Win Rate: 68.75% (updated)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
              END
```

---

## ğŸ’¾ Database Structure

```
Trade Collection
â”œâ”€â”€ _id: ObjectId("...")
â”œâ”€â”€ userId: ObjectId("user123")
â”œâ”€â”€ strategyId: ObjectId("bot456")
â”œâ”€â”€ symbol: "BTCUSDT"
â”œâ”€â”€ type: "buy"
â”œâ”€â”€ side: "long"
â”œâ”€â”€ entryPrice: 65000
â”œâ”€â”€ exitPrice: 67000
â”œâ”€â”€ quantity: 0.1
â”œâ”€â”€ stopLoss: 64000
â”œâ”€â”€ takeProfit: 67000
â”œâ”€â”€ leverage: 10
â”œâ”€â”€ pnl: 200.00
â”œâ”€â”€ pnlPercentage: 3.08
â”œâ”€â”€ status: "closed"
â”œâ”€â”€ exchange: "binance"
â”œâ”€â”€ entryTime: 2024-01-15T10:30:00Z
â”œâ”€â”€ exitTime: 2024-01-15T14:30:00Z
â”œâ”€â”€ fees: 5.00
â”œâ”€â”€ notes: "Take profit hit at $67,000"
â”œâ”€â”€ createdAt: 2024-01-15T10:30:00Z
â””â”€â”€ updatedAt: 2024-01-15T14:30:00Z
```

---

## ğŸ”Œ API Integration Points

```
Frontend Component
      â”‚
      â”‚ useEffect(() => {
      â”‚   fetchTrades()
      â”‚ }, [])
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GET /api/trades/   â”‚
â”‚      stats          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Auth   â”‚
     â”‚  Check  â”‚
     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
          â”‚ âœ… Authenticated
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Connect DB  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TradeManager.getTradeStats()â”‚
â”‚                             â”‚
â”‚ Trade.find({userId})        â”‚
â”‚   .filter(status='closed')  â”‚
â”‚   .reduce((sum, t) => pnl)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ Response â”‚
         â”‚  {       â”‚
         â”‚   open:2 â”‚
         â”‚   pnl:$$ â”‚
         â”‚  }       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Trade State Machine

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   NEW    â”‚
        â”‚  Trade   â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
             â”‚ createTrade()
             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”Œâ”€â”€â”€â”€â”‚   OPEN   â”‚â”€â”€â”€â”€â”
   â”‚    â”‚ Position â”‚    â”‚
   â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â”‚
   â”‚         â”‚          â”‚
   â”‚         â”‚          â”‚
   â”‚ Stop    â”‚ Take     â”‚ Manual
   â”‚ Loss    â”‚ Profit   â”‚ Close
   â”‚ Hit     â”‚ Hit      â”‚
   â”‚         â”‚          â”‚
   â”‚         â–¼          â”‚
   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   â””â”€â”€â”€â–¶â”‚  CLOSED  â”‚â—€â”€â”€â”˜
        â”‚ Position â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Calculateâ”‚
        â”‚   PnL    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Update  â”‚
        â”‚Dashboard â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Special Cases:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ERROR   â”‚â”€â”€â”€â”€â”€â–¶ cancelTrade()
â”‚ Detected â”‚      â””â”€â”€â–¶ status: 'cancelled'
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Statistics Calculation

```
User's Trade History
â”œâ”€â”€ Trade 1: +$150 (CLOSED)
â”œâ”€â”€ Trade 2: -$50  (CLOSED)
â”œâ”€â”€ Trade 3: +$300 (CLOSED)
â”œâ”€â”€ Trade 4: +$200 (OPEN)
â””â”€â”€ Trade 5: +$100 (OPEN)

TradeManager.getTradeStats()
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Filter & Calculate    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Closed Trades: 3       â”‚
â”‚  â””â”€ [1, 2, 3]         â”‚
â”‚                        â”‚
â”‚ Open Trades: 2         â”‚
â”‚  â””â”€ [4, 5]            â”‚
â”‚                        â”‚
â”‚ Total PnL: $400        â”‚
â”‚  â””â”€ 150 - 50 + 300    â”‚
â”‚                        â”‚
â”‚ Winning Trades: 2      â”‚
â”‚  â””â”€ [1, 3]            â”‚
â”‚                        â”‚
â”‚ Losing Trades: 1       â”‚
â”‚  â””â”€ [2]               â”‚
â”‚                        â”‚
â”‚ Win Rate: 66.67%       â”‚
â”‚  â””â”€ (2 / 3) Ã— 100     â”‚
â”‚                        â”‚
â”‚ Avg Profit: $133.33    â”‚
â”‚  â””â”€ 400 / 3           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Security Flow

```
HTTP Request
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NextAuth    â”‚
â”‚ Session     â”‚
â”‚ Check       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ No session
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ 401 Unauthorized
       â”‚
       â”‚ Has session
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Extract     â”‚
â”‚ userId from â”‚
â”‚ session     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Query DB    â”‚
â”‚ with userId â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Verify      â”‚
â”‚ Ownership   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Not owner
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ 403 Forbidden
       â”‚
       â”‚ Is owner
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Process     â”‚
â”‚ Request     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
    Response
```

---

## ğŸ§® PnL Calculation Flow

```
Trade Data:
â”œâ”€ Entry Price: $65,000
â”œâ”€ Exit Price: $67,000
â”œâ”€ Quantity: 0.1 BTC
â”œâ”€ Side: LONG
â””â”€ Fees: $5

calculatePnL()
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Check Position Side   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    LONG â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ pnl = (exitPrice -     â”‚
â”‚        entryPrice) Ã—   â”‚
â”‚        quantity        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ = (67000 - 65000) Ã— 0.1â”‚
â”‚ = 2000 Ã— 0.1           â”‚
â”‚ = $200                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Subtract Fees         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ pnl = 200 - 5          â”‚
â”‚     = $195             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Calculate Percentage   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ % = (67000-65000)/65000â”‚
â”‚   = 2000/65000 Ã— 100   â”‚
â”‚   = 3.08%              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    Return Results
```

---

## ğŸ”— Component Integration

```
Dashboard Page
â”œâ”€â”€ useState: trades, stats, loading
â”‚
â”œâ”€â”€ useEffect: fetchData()
â”‚   â”œâ”€â”€ GET /api/trades/stats
â”‚   â””â”€â”€ GET /api/trades/active
â”‚
â”œâ”€â”€ Components:
â”‚   â”‚
â”‚   â”œâ”€â”€ StatsWidget
â”‚   â”‚   â”œâ”€â”€ Total Profit: ${stats.totalProfit}
â”‚   â”‚   â”œâ”€â”€ Win Rate: {stats.winRate}%
â”‚   â”‚   â””â”€â”€ Active: {stats.openTrades}
â”‚   â”‚
â”‚   â”œâ”€â”€ ActiveTradesList
â”‚   â”‚   â””â”€â”€ {trades.map(trade => (
â”‚   â”‚         <TradeCard
â”‚   â”‚           symbol={trade.symbol}
â”‚   â”‚           side={trade.side}
â”‚   â”‚           entry={trade.entryPrice}
â”‚   â”‚           pnl={trade.pnl}
â”‚   â”‚         />
â”‚   â”‚       ))}
â”‚   â”‚
â”‚   â””â”€â”€ TradeHistory
â”‚       â””â”€â”€ Closed trades table
â”‚
â””â”€â”€ Auto-refresh: setInterval(fetchData, 30000)
```

---

## ğŸ¨ Data Flow Visualization

```
User starts bot
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Bot Instance â”‚â”€â”€â”€â”€â”€â”€â”
â”‚  (Running)   â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
       â”‚              â”‚
       â”‚ Analyzes     â”‚
       â–¼              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ Market Data  â”‚      â”‚
â”‚ (Binance API)â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
       â”‚              â”‚
       â”‚ Signal       â”‚
       â–¼              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ Execute Buy  â”‚      â”‚
â”‚ (Binance)    â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
       â”‚              â”‚
       â”‚ Success      â”‚
       â–¼              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ botInstanceId
â”‚ TradeManager â”‚â—€â”€â”€â”€â”€â”€â”˜
â”‚ createTrade()â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Saves to
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MongoDB    â”‚
â”‚ Trade Record â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Queries
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dashboard   â”‚
â”‚  (Frontend)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± Mobile View Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Dashboard       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     â”‚
â”‚ ğŸ’° Total Balance    â”‚
â”‚    $10,000.00       â”‚
â”‚                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     â”‚
â”‚ ğŸ“Š Statistics       â”‚
â”‚                     â”‚
â”‚ Active Trades: 2    â”‚
â”‚ Total Profit: +$1K  â”‚
â”‚ Win Rate: 66.67%    â”‚
â”‚                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     â”‚
â”‚ ğŸ“ˆ Active Trades    â”‚
â”‚                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ BTC/USDT LONG   â”‚ â”‚
â”‚ â”‚ Entry: $65,000  â”‚ â”‚
â”‚ â”‚ PnL: +$150 âœ…   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ETH/USDT SHORT  â”‚ â”‚
â”‚ â”‚ Entry: $3,500   â”‚ â”‚
â”‚ â”‚ PnL: +$85 âœ…    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Refresh] [Export]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Architecture Completed âœ…**
- Clear separation of concerns
- Scalable design
- Easy to test
- Well documented

